name: Ì∫Ä Deploy AI-Nexus DEX Engine to Render

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Ì∞ç Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Ì≥¶ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Ì∑™ Run tests
      run: |
        python -m pytest tests/ -v --cov=src
        
    - name: Ì¥í Security audit
      run: |
        python src/security/audit_pipeline.py --contracts all
        
    - name: Ì≥ä Performance validation
      run: |
        python src/validation/backtesting.py --validate-profit-claims --daily-target 250000
        
    - name: Ì∫Ä Deploy to Render
      uses: johnbeynon/render-deploy-action@v0.0.8
      with:
        service-id: ${{ secrets.RENDER_SERVICE_ID }}
        api-key: ${{ secrets.RENDER_API_KEY }}
